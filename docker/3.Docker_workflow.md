Create a real development, testing and production workflow with Docker
==============

# Application creation workflow

> Even though Docker is not required to develop an application, it is very helpful! **The objective is to understand HOW to use Docker with other services to develop, build and deploy an application**.
> 

## Overview
This section explains how to _develop_, _test_ and _deploy_ an application with Docker. It explains how to do the **first release** and later **upgrades**, because any standard application has many releases. 


!["Application development workflow"](./images/26_application_workflow.png "Application development workflow")

## Development workflow in details

For the sake of clarity, let's assume that we use the following:

!["Development cycles"](images/27_development_workflow.png "Development cylces")

Workflow steps:
1. New developments
    * Developers are working on a SNAPSHOT version, ex: `1.0.0-SNAPSHOT`. This means the version is not yet complete or stable.
    * Developers _commit_ and _push_ their new code in GIT **_feature branches_**
    * When the feature is complete - including unit tests - a _merge request_ is created.
2. Integrate feature into the application
    * Other developer(s) review the code, then _approve_ the changes.
    * Code changes are _pushed_ to the **_develop_** branch
    * This _push_ triggers the **Continous Integration** process: build with unit tests + quality checks.
3. Bundle application and create new release
    * Later on, when enough features are there or depending on the project due-date, another _merge request_ is created. 
    * After _approval_, the code is _pushed_ on the **_main_** branch. 
    * project version changes:
      * Main branch = release version `v1.0.0`
      * Develop branch = next development version `v1.1.0-SNAPSHOT`
    * **Continuous Integration** process is triggered: application build with tests and quality checks
    * Upon build success, branch master is **tagged** *v1.0.0* in GIT
    * **Continuous Delivery**  are triggered and changes are automatically deployed
  

Key points: 
* **You shall not create a _merge request_ to _main_ until the develop branch is stable!** Continuous Integration must be successfull (with tests and quality checks) BEFORE you push the code the _main_ branch.
* Continuous Integration (CI) can be use for all projects branches, not only _main_ or _develop_ branches


## What about Docker?

Docker is NOT needed to develop an application and this generic workflow can be exectued without Docker. However, even though it is not a requirement, **Docker is a tool that's going to make executing some of these development tasks and roll-out a lot, lot easier**.

## Demonstration application

For this part we will create a small _react_ application.

* Make sure you have [NodeJS](https://nodejs.org/) installed on your machine. Feel free to install the extensions, some might be needed to build the REACT project.
* Then follow the [React # Getting started with NPM](https://create-react-app.dev/docs/getting-started/#nsspx) tutorial

## Create REACT frontend

```bash
### Uninstall previous package, if you've previously installed 'create-react-app' globally 
npm uninstall -g create-react-app

### Go to your workspace directory
mkdir -p exercices

### Install latest version of the react-app
npm init react-app section_6_frontend

# Start default application and navigate to http://localhost:3000
npm start
```

Key commands:

!["NPM commands"](images/28_NPM_commands.png "NPM commands")


## Initialize `Dockerfile.dev`

### Principle
We actually need **2** `Dockerfile` for this project. Both files must be at the root of the application.
* A _development_ container for `npm run start`
* A _production_ container for `npm run build`

!["Docker files"](images/29_Docker_file.png "Docker files")


Like _Spring_, you can create "profiles". 
* Development: `Dockerfile.dev`   ; notice the _.dev_ extension
* Production: `Dockerfile`


### Dockerfile

Checkout the ["dockerfile.dev section_6"](./exercices/section_6/Dockerfile.dev)


### Build

To build the DEV docker file: 

```
docker build -t guihomediaz/
```




## Tooling
* GIT repository = [GitHub](https://github.com/)
* GIT client = [GIT SCM](https://git-scm.com/)
* NodeJS = [NodeJS](https://nodejs.org/)
* Continuous Integration = [Travis CI](https://www.travis-ci.com/)
* Continous Deployment = [Amazon AWS](https://aws.amazon.com/)